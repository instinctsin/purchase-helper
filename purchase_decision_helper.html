<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ë„ìš°ë¯¸ V2 - ìµœì¢… í†µí•© (ë¡œê·¸ ìˆ˜ì •)</title>
  <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Gothic&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      font-family: 'Nanum Gothic', 'Jua', sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #fffafc;
      color: #444;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(255, 182, 193, 0.3);
      border: 2px dashed #ffd1dc;
    }
    h1, h2 {
      color: #d26a94;
      text-align: center;
    }
    #path-tracker {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #fff0f5;
      border-radius: 12px;
      border: 1px solid #ffe4ec;
    }
    #path-tracker h2 {
      font-size: 1em;
      margin-top: 0;
      text-align: left;
      color: #c86485;
    }
    #path-list {
      list-style-type: none;
      padding-left: 0;
      max-height: 150px;
      overflow-y: auto;
    }
    #path-list li {
      padding: 6px 0 6px 25px;
      border-bottom: 1px dashed #ffd1dc;
      font-size: 0.95em;
      position: relative;
    }
    #path-list li::before {
      content: "ğŸ’—";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      color: #ff85a2;
    }
    #path-list li:last-child {
        border-bottom: none;
    }
    #question-area {
      padding: 20px;
      border: 2px solid #ffe4ec;
      border-radius: 10px;
      margin-bottom: 20px;
      background-color: #fff5f8;
    }
    #question-title {
      margin-top: 0;
      color: #e6739f;
    }
    #item-input {
      margin-bottom: 20px;
    }
    #item-input label {
        display: block;
        margin-bottom: 8px;
        color: #c86485;
        font-weight: bold;
    }
    #item-name {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      border: 1px solid #ffd1dc;
      border-radius: 8px;
      font-family: 'Nanum Gothic', sans-serif;
    }
    #item-name:focus {
        outline: none;
        border-color: #ff8fa3;
        box-shadow: 0 0 5px rgba(255, 182, 193, 0.5);
    }
    #options-area button {
      display: block;
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      background-color: #ffb6c1;
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1.05em;
      font-family: 'Jua', sans-serif;
      font-weight: normal;
      box-shadow: 0 4px 10px rgba(255, 182, 193, 0.4);
      transition: all 0.2s ease-in-out;
    }
    #options-area button:hover {
      background-color: #ff8fa3;
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 12px rgba(255, 182, 193, 0.5);
    }
    #options-area button.secondary {
      background-color: #f0ad4e;
    }
    #options-area button.secondary:hover {
      background-color: #ec971f;
    }
    #options-area button.tertiary {
      background-color: #d9534f;
    }
    #options-area button.tertiary:hover {
      background-color: #c9302c;
    }
    #result-area {
      padding: 20px;
      background-color: #e0ffe0;
      border: 2px dashed #b2fab4;
      color: #3c763d;
      border-radius: 10px;
      text-align: center;
    }
    #result-area.negative {
      background-color: #ffe6ea;
      border-color: #f5c6cb;
      color: #b33c50;
    }
    #restart-button {
      padding: 12px 24px;
      background-color: #a6c8ff;
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1em;
      margin-top: 20px;
      font-family: 'Jua', sans-serif;
      box-shadow: 0 4px 10px rgba(173, 216, 230, 0.4);
      transition: all 0.2s ease-in-out;
    }
    #restart-button:hover {
      background-color: #82b4ff;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 12px rgba(173, 216, 230, 0.5);
    }
    .summary-and-buttons-container {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        text-align: left;
    }
    .summary-and-buttons-container h3 {
        margin-top: 0;
        color: #495057;
        font-size: 1.1em;
        border-bottom: 1px solid #ced4da;
        padding-bottom: 5px;
        margin-bottom: 10px;
    }
    .summary-and-buttons-container ul {
        list-style-type: none;
        padding-left: 0;
        margin-bottom: 15px;
    }
    .summary-and-buttons-container li {
        font-size: 0.9em;
        padding: 3px 0;
        color: #6c757d;
    }
    .buttons-group {
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px solid #eee;
        text-align: center;
    }
    .buttons-group button {
        padding: 8px 15px;
        margin: 5px;
        border-radius: 20px;
        border: none;
        cursor: pointer;
        font-family: 'Nanum Gothic', sans-serif;
        font-weight: bold;
        transition: all 0.2s ease;
        color: white;
    }
    .buttons-group button.save-txt { background-color: #6c757d; }
    .buttons-group button.save-txt:hover { background-color: #5a6268; }
    .buttons-group button.save-md { background-color: #007bff; }
    .buttons-group button.save-md:hover { background-color: #0056b3; }
    .buttons-group button.save-json { background-color: #28a745; }
    .buttons-group button.save-json:hover { background-color: #1e7e34; }
    .buttons-group button.save-pdf { background-color: #dc3545; }
    .buttons-group button.save-pdf:hover { background-color: #c82333; }
    .buttons-group button.copy-button { background-color: #17a2b8; }
    .buttons-group button.copy-button:hover { background-color: #138496; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’• êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ë„ìš°ë¯¸ V2 ğŸ’•</h1>
    <div id="path-tracker">
      <h2>âœ¨ ë‚˜ì˜ ê²°ì • ì—¬ì • âœ¨</h2>
      <ul id="path-list"></ul>
    </div>
    <div id="question-area">
      <div id="item-input">
        <label for="item-name">ğŸ›ï¸ êµ¬ë§¤í•˜ë ¤ëŠ” ë¬¼ê±´/ì„œë¹„ìŠ¤ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</label>
        <input type="text" id="item-name" placeholder="ì˜ˆ: ìµœì‹ í˜• ìŠ¤ë§ˆíŠ¸í°, ì˜¨ë¼ì¸ ê°•ì˜ ìˆ˜ê°•ê¶Œ">
      </div>
      <h2 id="question-title"></h2>
      <p id="question-text"></p>
      <div id="options-area"></div>
    </div>
    <div id="result-area" style="display: none;">
      <h2 id="result-title"></h2>
      <p id="result-text"></p>
      <button id="restart-button">ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ê³ ë¯¼í•˜ê¸° ğŸ”„</button>
    </div>
  </div>
  <script>
    const questionArea = document.getElementById('question-area');
    const questionTitleEl = document.getElementById('question-title');
    const questionTextEl = document.getElementById('question-text');
    const optionsArea = document.getElementById('options-area');
    const resultArea = document.getElementById('result-area');
    const resultTitleEl = document.getElementById('result-title');
    const resultTextEl = document.getElementById('result-text');
    const restartButton = document.getElementById('restart-button');
    const pathListEl = document.getElementById('path-list');
    const itemNameInput = document.getElementById('item-name');

    let currentQuestionId = 'start';
    let userPath = [];
    let originalUserPathWithEmoji = [];

    const decisionTree = {
        'start': { title: 'ğŸ¤” 1ë‹¨ê³„: í•„ìš”ì„± ì ê²€', text: 'ì´ê²ƒì´ ì •ë§ í•„ìš”í•œê°€ìš”, ì•„ë‹ˆë©´ ë‹¨ìˆœí•œ ìš•êµ¬ì¸ê°€ìš”?', options: [ { text: 'âœ”ï¸ ì •ë§ í•„ìš”í•´ìš” (Need)', nextNodeId: 'need_check_alternatives' }, { text: 'ğŸ’– ê·¸ëƒ¥ ê°–ê³  ì‹¶ì–´ìš” (Want)', nextNodeId: 'want_reconsider_1', type: 'secondary' } ] },
        'need_check_alternatives': { title: 'ğŸ¤” 1-1ë‹¨ê³„: í•„ìš”ì„± ì‹¬ì¸µ ë¶„ì„', text: 'ì´ê²ƒ ì—†ì´ í˜„ì¬ì˜ ë¶ˆí¸í•¨/ë¬¸ì œë¥¼ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆë‚˜ìš”?', options: [ { text: 'ì•„ë‹ˆì˜¤, ì´ ë°©ë²•ì´ ìµœì„ ì¸ ê²ƒ ê°™ì•„ìš”.', nextNodeId: 'budget_check_initial' }, { text: 'ë„¤, ë‹¤ë¥¸ í•´ê²°ì±…ë„ ìˆì–´ìš”.', nextNodeId: 'explore_alternatives_first', type: 'secondary' } ] },
        'explore_alternatives_first': { result: { title: 'ğŸ¤” ì ì‹œë§Œ! ëŒ€ì•ˆ íƒìƒ‰ë¶€í„°!', text: 'ë‹¤ë¥¸ í•´ê²°ì±…ì„ ë¨¼ì € ì¶©ë¶„íˆ íƒìƒ‰í•´ ë³´ì„¸ìš”. êµ¬ë§¤ëŠ” ê·¸ ì´í›„ì— ê³ ë ¤í•´ë„ ëŠ¦ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì¢‹ì€ ë°©ë²•ì´ ìˆì„ì§€ë„ ëª°ë¼ìš”!', type: 'negative' } },
        'want_reconsider_1': { title: 'ğŸ’¸ 1-1ë‹¨ê³„: ìš•êµ¬ ì¬ê³  (ê¸°íšŒë¹„ìš©)', text: 'ì´ê²ƒì„ êµ¬ë§¤í•¨ìœ¼ë¡œì¨ í¬ê¸°í•´ì•¼ í•˜ëŠ” ë‹¤ë¥¸ ì¤‘ìš”í•œ ê²ƒì€ ì—†ë‚˜ìš”? (ì˜ˆ: ì €ì¶•, ë‹¤ë¥¸ í•„ìš”í•œ ë¬¼ê±´, ì†Œì¤‘í•œ ê²½í—˜)', options: [ { text: 'ê´œì°®ì•„ìš”, ì´ ê°–ê³  ì‹¶ì€ ë§ˆìŒì„ í¬ê¸°í•  ìˆ˜ ì—†ì–´ìš”!', nextNodeId: 'want_impulse_check' }, { text: 'ìŒ... í¬ê¸°í•´ì•¼ í•  ê²ƒì´ ìˆë„¤ìš”. ì†Œì¤‘í•œ ë‹¤ë¥¸ ê²ƒì„ìš”.', nextNodeId: 'want_reconsider_2', type: 'secondary' } ] },
        'want_impulse_check': { title: 'ğŸš¨ 1-2ë‹¨ê³„: ì¶©ë™êµ¬ë§¤ ë°©ì§€í„±', text: 'í˜¹ì‹œ ì§€ê¸ˆ ë„ˆë¬´ ì¦‰í¥ì ì¸ ê²°ì •ì€ ì•„ë‹Œê°€ìš”? "24ì‹œê°„ì˜ ë²•ì¹™"ì²˜ëŸ¼, í•˜ë£¨ ì´í‹€ ë” ê³ ë¯¼í•´ë³´ëŠ” ê±´ ì–´ë•Œìš”?', options: [ { text: 'ì´ë¯¸ ì¶©ë¶„íˆ ê³ ë¯¼í–ˆì–´ìš”! ì´ê±´ ìš´ëª…ì´ì—ìš”!', nextNodeId: 'budget_check_initial' }, { text: 'ì¢‹ì€ ìƒê°ì´ì—ìš”, ì¡°ê¸ˆ ë” ì‹œê°„ì„ ê°–ê³  ì°¨ë¶„íˆ ìƒê°í•´ë³¼ê²Œìš”.', nextNodeId: 'postpone_decision_for_want', type: 'secondary' } ] },
        'postpone_decision_for_want': { result: { title: 'ğŸ˜Œ êµ¬ë§¤ ë³´ë¥˜: ì‹ ì¤‘í•œ ê³ ë¯¼ì´ í•„ìš”í•´ìš”', text: 'ì¶©ë™êµ¬ë§¤ëŠ” ì¢…ì¢… í›„íšŒì˜ ì§€ë¦„ê¸¸ì´ ë  ìˆ˜ ìˆì–´ìš”. ì‹œê°„ì„ ê°–ê³  ë‹¤ì‹œ í•œë²ˆ ê³°ê³°ì´ ìƒê°í•´ë³´ì„¸ìš”! í›„íšŒ ì—†ëŠ” ì„ íƒì„ ì‘ì›í•©ë‹ˆë‹¤.', type: 'negative' } },
        'want_reconsider_2': { result: { title: 'ğŸ˜¥ êµ¬ë§¤ ë³´ë¥˜: ê¸°íšŒë¹„ìš©ì„ ìƒê°í•´ì£¼ì„¸ìš”', text: 'ë” ì¤‘ìš”í•˜ê±°ë‚˜ í•„ìš”í•œ ê³³ì— ì†Œì¤‘í•œ ìì›ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ìš°ì„ ì ìœ¼ë¡œ ê³ ë ¤í•´ë³´ì„¸ìš”. ë‹¹ì‹ ì˜ í˜„ëª…í•œ ì„ íƒì„ ë¯¿ì–´ìš”!', type: 'negative' } },
        'budget_check_initial': { title: 'ğŸ’° 2ë‹¨ê³„: ì˜ˆì‚° ì ê²€', text: 'í˜„ì¬ ì¤€ë¹„ëœ ì˜ˆì‚° ì•ˆì—ì„œ ì¶©ë¶„íˆ êµ¬ë§¤ ê°€ëŠ¥í•œê°€ìš”?', options: [ { text: 'ë„¤, ì˜ˆì‚°ì€ ì¶©ë¶„í•˜ê³  ê³„íšì ì´ì—ìš”!', nextNodeId: 'product_research_start' }, { text: 'ì•„ë‹ˆì˜¤, ì‚¬ì‹¤ ì˜ˆì‚°ì´ ì¢€ ë¶€ì¡±í•´ìš”...', nextNodeId: 'budget_financing_check', type: 'secondary' } ] },
        'budget_financing_check': { title: 'ğŸ’³ 2-1ë‹¨ê³„: ì¶”ê°€ ìê¸ˆ ì¡°ë‹¬ ê³„íš', text: 'í˜¹ì‹œ í• ë¶€ë‚˜ ëŒ€ì¶œì„ ìƒê°í•˜ê³  ìˆë‚˜ìš”? ë§Œì•½ ê·¸ë ‡ë‹¤ë©´, ì´ ì´ì ë¹„ìš©ê¹Œì§€ ê¼¼ê¼¼íˆ í™•ì¸í–ˆê³  ê°ë‹¹ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì¸ê°€ìš”?', options: [ { text: 'ë„¤, ì´ìê¹Œì§€ ê³ ë ¤í•´ë„ ê´œì°®ì•„ìš”! ì² ì €íˆ ê³„ì‚°í–ˆì–´ìš”.', nextNodeId: 'product_research_start' }, { text: 'ì•„ë‹ˆì˜¤, ì¶”ê°€ ë¹„ìš©ì€ ë¶€ë‹´ìŠ¤ëŸ¬ì›Œìš” / ê³„íš ì—†ì–´ìš”.', nextNodeId: 'budget_save_up', type: 'secondary' } ] },
        'budget_save_up': { result: { title: 'â³ êµ¬ë§¤ ë³´ë¥˜: ì˜ˆì‚° í™•ë³´ê°€ ìš°ì„ ì´ì—ìš”', text: 'ë¬´ë¦¬í•œ ì§€ì¶œì€ ë¯¸ë˜ì˜ ë‚˜ë¥¼ í˜ë“¤ê²Œ í•  ìˆ˜ ìˆì–´ìš”. ì˜ˆì‚°ì„ ë¨¼ì € í™•ë³´í•˜ëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì°¨ê·¼ì°¨ê·¼ ì €ì¶• ê³„íšì„ ì„¸ì›Œë³´ëŠ” ê±´ ì–´ë•Œìš”?', type: 'negative' } },
        'product_research_start': { title: 'ğŸ” 3ë‹¨ê³„: ì œí’ˆ/ì„œë¹„ìŠ¤ ê¼¼ê¼¼ ì¡°ì‚¬', text: 'ìµœì†Œ 2-3ê°œ ì´ìƒì˜ ë‹¤ë¥¸ ì œí’ˆ/ì„œë¹„ìŠ¤ì™€ ë¹„êµ ë¶„ì„í–ˆë‚˜ìš”? (ìƒì„¸ ìŠ¤í™, ê°€ê²©, ì‚¬ìš©ì í›„ê¸° ë“±)', options: [ { text: 'ë„¤, íƒì •ì²˜ëŸ¼ ê¼¼ê¼¼íˆ ë¹„êµí–ˆì–´ìš”!', nextNodeId: 'product_review_check' }, { text: 'ì•„ë‹ˆì˜¤, ì•„ì§ ì¶©ë¶„íˆ ì•Œì•„ë³´ì§€ ëª»í–ˆì–´ìš”.', nextNodeId: 'research_more_needed', type: 'secondary' } ] },
        'research_more_needed': { result: { title: 'ğŸ“š êµ¬ë§¤ ë³´ë¥˜: ë” ë§ì€ ì •ë³´ê°€ í•„ìš”í•´ìš”', text: 'ì¶©ë¶„í•œ ì •ë³´ ì—†ì´ í•˜ëŠ” êµ¬ë§¤ëŠ” ì‹¤íŒ¨ í™•ë¥ ì´ ë†’ì•„ìš”. ì‹œê°„ì„ ë“¤ì—¬ ë‹¤ì–‘í•œ ëŒ€ì•ˆì„ í­ë„“ê²Œ ë¹„êµ ë¶„ì„í•´ë³´ì„¸ìš”!', type: 'negative' } },
        'product_review_check': { title: 'ğŸ‘ğŸ‘ 3-1ë‹¨ê³„: í›„ê¸° ë° ë‹¨ì  í™•ì¸', text: 'ê°ê´€ì ì¸ ì „ë¬¸ê°€ ë¦¬ë·°ë‚˜ ë¯¿ì„ ë§Œí•œ ì‚¬ìš©ì í›„ê¸°ë¥¼ ì¶©ë¶„íˆ í™•ì¸í–ˆë‚˜ìš”? ê·¸ë¦¬ê³  ì´ ì œí’ˆ/ì„œë¹„ìŠ¤ì˜ ëª…í™•í•œ ë‹¨ì ë„ ì•Œê³  ìˆë‚˜ìš”?', options: [ { text: 'ë„¤, ì¥ë‹¨ì  ëª¨ë‘ íŒŒì•…í–ˆê³  ë‹¨ì ë„ ì œê°€ ê°ìˆ˜í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ì´ì—ìš”!', nextNodeId: 'purchase_timing_check' }, { text: 'ì•„ë‹ˆì˜¤, ë‹¨ì ì´ ìƒê°ë³´ë‹¤ ì¹˜ëª…ì ì´ê±°ë‚˜ ì•„ì§ ì˜ ëª¨ë¥´ê² ì–´ìš”.', nextNodeId: 'reconsider_due_to_drawbacks', type: 'secondary' } ] },
        'reconsider_due_to_drawbacks': { result: { title: 'âš ï¸ êµ¬ë§¤ ì¬ê³ ë ¤: ê²°ì •ì ì¸ ë‹¨ì  í™•ì¸', text: 'ì œí’ˆ/ì„œë¹„ìŠ¤ì˜ ë‹¨ì ì„ ì ˆëŒ€ ê°„ê³¼í•˜ì§€ ë§ˆì„¸ìš”! ë§Œì•½ ìˆ˜ìš©í•˜ê¸° ì–´ë ¤ìš´ ë‹¨ì ì´ë¼ë©´, ë‹¤ë¥¸ ë” ì¢‹ì€ ëŒ€ì•ˆì„ ì°¾ì•„ë³´ëŠ” ê²ƒì´ í˜„ëª…í•©ë‹ˆë‹¤.', type: 'negative' } },
        'purchase_timing_check': { title: 'â° 4ë‹¨ê³„: êµ¬ë§¤ ìµœì  ì‹œì  íŒë‹¨', text: 'ì§€ê¸ˆ ë‹¹ì¥ êµ¬ë§¤í•´ì•¼ í•˜ëŠ” íŠ¹ë³„í•œ ì´ìœ ê°€ ìˆë‚˜ìš”? ì•„ë‹ˆë©´ ì¡°ê¸ˆ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë” ì¢‹ì€ ì¡°ê±´(í• ì¸ í–‰ì‚¬, ì‹ ì œí’ˆ ì¶œì‹œ ë“±)ì— êµ¬ë§¤í•  ìˆ˜ë„ ìˆì„ê¹Œìš”?', options: [ { text: 'ì§€ê¸ˆì´ ë°”ë¡œ êµ¬ë§¤í•  íƒ€ì´ë°ì¸ ê²ƒ ê°™ì•„ìš”!', nextNodeId: 'final_confirmation' }, { text: 'ê¸°ë‹¤ë¦´ ìˆ˜ ìˆê³ , ë” ì¢‹ì€ ì¡°ê±´ì´ ê³§ ë‚˜ì˜¬ ê²ƒ ê°™ì•„ìš”.', nextNodeId: 'wait_for_better_deal', type: 'secondary' } ] },
        'wait_for_better_deal': { result: { title: 'ğŸ§˜ êµ¬ë§¤ ë³´ë¥˜: ë” ì¢‹ì€ ì‹œê¸°ë¥¼ ê¸°ë‹¤ë ¤ë´ìš”', text: 'ì¡°ê¸‰í•´í•  í•„ìš” ì—†ì–´ìš”! í˜„ëª…í•œ ê¸°ë‹¤ë¦¼ì€ ë” ë‚˜ì€ ê°€ê²©ì´ë‚˜ ì¡°ê±´ìœ¼ë¡œ ì›í•˜ëŠ” ê²ƒì„ ì–»ì„ ê¸°íšŒë¥¼ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ìœ ë¥¼ ê°€ì§€ì„¸ìš”!', type: 'negative' } },
        'final_confirmation': { title: 'ğŸ’¯ 5ë‹¨ê³„: ìµœì¢… ë§ˆìŒ í™•ì¸', text: 'ì§€ê¸ˆê¹Œì§€ ëª¨ë“  ê²ƒì„ ì‹ ì¤‘í•˜ê²Œ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤. ì´ êµ¬ë§¤ê°€ ì •ë§ í›„íšŒ ì—†ì„ ìµœì„ ì˜ ì„ íƒì´ë¼ê³  ë§ˆìŒ ê¹Šì´ í™•ì‹ í•˜ì‹œë‚˜ìš”?', options: [ { text: 'ë„¤, í™•ì‹ í•´ìš”! ë“œë””ì–´ êµ¬ë§¤í•˜ê² ìŠµë‹ˆë‹¤! ğŸ‰', nextNodeId: 'purchase_confirmed' }, { text: 'ì†”ì§íˆ... ì•„ì§ ì¡°ê¸ˆ ë§ì„¤ì—¬ì§€ëŠ” ë¶€ë¶„ì´ ìˆì–´ìš”... ğŸ¤”', nextNodeId: 'last_minute_hesitation', type: 'tertiary' } ] },
        'last_minute_hesitation': { result: { title: 'ğŸš¦ êµ¬ë§¤ ì§ì „, ë§ˆì§€ë§‰ ì ê²€!', text: 'ë§ˆì§€ë§‰ ìˆœê°„ì˜ ë§ì„¤ì„ì€ ì–´ì©Œë©´ ì¤‘ìš”í•œ ì‹ í˜¸ì¼ ìˆ˜ ìˆì–´ìš”. ë¬´ì—‡ì´ ë§ˆìŒì— ê±¸ë¦¬ëŠ”ì§€ ë‹¤ì‹œ í•œë²ˆ ì†”ì§í•˜ê²Œ ì ê²€í•´ë³´ì„¸ìš”. í•„ìš”í•˜ë‹¤ë©´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•œë²ˆ ìƒê°í•´ë³´ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤!', type: 'negative' } },
        'purchase_confirmed': { result: { title: 'ğŸ’–âœ¨ êµ¬ë§¤ ê²°ì • ì™„ë£Œ! âœ¨ğŸ’–', text: 'ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¹ì‹ ì˜ ì‹ ì¤‘í•˜ê³  í˜„ëª…í•œ ê³ ë¯¼ ëì— ë‚´ë¦° ê²°ì •ì…ë‹ˆë‹¤. ì´ êµ¬ë§¤ê°€ ë‹¹ì‹ ì—ê²Œ í° ë§Œì¡±ê³¼ í–‰ë³µì„ ê°€ì ¸ë‹¤ì£¼ê¸°ë¥¼ ë°”ëë‹ˆë‹¤! ğŸ¥³', type: 'positive' } }
    };

    function removeEmoji(text) {
        if (typeof text !== 'string') return '';
        return text.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD00-\uDDFF]|\uD83C[\uDDE6-\uDDFF]{2}|[\uD800-\uDBFF][\uDC00-\uDFFF])/g, '').trim();
    }

    function displayQuestion(nodeId) {
      // ì²« ì§ˆë¬¸ ì‹œì‘ ì‹œ ë˜ëŠ” ì•„ì´í…œ ì´ë¦„ì´ ì—†ì„ ë•Œ ì•„ì´í…œ ì…ë ¥ì— í¬ì»¤ìŠ¤
      // currentQuestionIdë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ì–´ë–¤ ì§ˆë¬¸ì„ ì²˜ë¦¬ ì¤‘ì¸ì§€ ëª…í™•íˆ í•¨
      if (nodeId === 'start' && (currentQuestionId === 'start' || userPath.length <= 1) ) {
        if (!itemNameInput.value.trim()) {
            itemNameInput.focus();
        }
      }

      const node = decisionTree[nodeId];
      if (node.result) {
        questionArea.style.display = 'none';
        resultArea.style.display = 'block';
        const itemName = itemNameInput.value.trim() || 'ì…ë ¥ëœ ì•„ì´í…œ ì—†ìŒ';
        resultTitleEl.textContent = node.result.title;
        resultTextEl.textContent = `${node.result.text}\n\nğŸ›ï¸ "${itemName}"ì— ëŒ€í•œ ê²°ì •ì´ì—ˆìŠµë‹ˆë‹¤.`;

        resultArea.classList.remove('negative', 'positive');
        if (node.result.type === 'negative') {
          resultArea.classList.add('negative');
        } else {
          resultArea.classList.add('positive');
        }
        // ìµœì¢… ê²°ê³¼ í‘œì‹œëŠ” ì—¬ê¸°ì„œ, ë¡œê·¸ ê¸°ë¡ì€ displaySummaryAndButtonsì—ì„œ ì²˜ë¦¬
        displaySummaryAndButtons();
        return;
      }

      if (nodeId !== 'start' && !itemNameInput.value.trim() && currentQuestionId !== 'start') { // currentQuestionId ì¡°ê±´ ì¶”ê°€
          alert("êµ¬ë§¤í•˜ë ¤ëŠ” ë¬¼ê±´/ì„œë¹„ìŠ¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ›ï¸");
          itemNameInput.focus();
          return;
      }

      questionArea.style.display = 'block';
      resultArea.style.display = 'none';
      questionTitleEl.textContent = node.title;
      questionTextEl.textContent = node.text;
      optionsArea.innerHTML = '';

      node.options.forEach(option => {
        const button = document.createElement('button');
        button.textContent = option.text;
        if (option.type) button.classList.add(option.type);
        button.onclick = () => {
          // ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ ì§ˆë¬¸/ì„ íƒ ë¡œê·¸ ê¸°ë¡
          logToPath(`"${removeEmoji(node.title)}" ì§ˆë¬¸ì— "${removeEmoji(option.text)}" ì„ íƒ`, `"${node.title}" ì§ˆë¬¸ì— "${option.text}" ì„ íƒ`);
          currentQuestionId = option.nextNodeId; // currentQuestionId ì—…ë°ì´íŠ¸
          displayQuestion(currentQuestionId);    // ì—…ë°ì´íŠ¸ëœ IDë¡œ ë‹¤ìŒ ì§ˆë¬¸ í‘œì‹œ
          window.scrollTo(0, 0);
        };
        optionsArea.appendChild(button);
      });
    }

    function logToPath(messageForLog, messageForDisplay) {
      userPath.push(messageForLog);
      originalUserPathWithEmoji.push(messageForDisplay);

      const li = document.createElement('li');
      li.textContent = messageForDisplay;
      pathListEl.appendChild(li);
      pathListEl.scrollTop = pathListEl.scrollHeight;
    }

    function displaySummaryAndButtons() {
      const existingContainer = resultArea.querySelector('.summary-and-buttons-container');
      if (existingContainer) {
        resultArea.removeChild(existingContainer);
      }

      const item = itemNameInput.value.trim() || 'ì…ë ¥ëœ ì•„ì´í…œ ì—†ìŒ';
      const container = document.createElement('div');
      container.classList.add('summary-and-buttons-container');

      const finalResultLogForData = `â¡ï¸ ìµœì¢… ê²°ê³¼: ${removeEmoji(resultTitleEl.textContent)}`;
      const finalResultLogForDisplay = `â¡ï¸ ìµœì¢… ê²°ê³¼: ${resultTitleEl.textContent}`;

      // ìµœì¢… ê²°ê³¼ ë¡œê·¸ê°€ ì•„ì§ ê¸°ë¡ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ê¸°ë¡
      if (userPath.length === 0 || userPath[userPath.length - 1] !== finalResultLogForData) {
          userPath.push(finalResultLogForData);
          originalUserPathWithEmoji.push(finalResultLogForDisplay);
          // í™”ë©´ì˜ path-listì—ë„ ìµœì¢… ê²°ê³¼ ë¡œê·¸ ì¶”ê°€ (ì„ íƒì )
          // const li = document.createElement('li');
          // li.textContent = finalResultLogForDisplay;
          // li.style.fontWeight = 'bold';
          // pathListEl.appendChild(li);
          // pathListEl.scrollTop = pathListEl.scrollHeight;
      }

      let summaryHTML = '<h3>ğŸ“Œ ë‚˜ì˜ ê²°ì • ë˜ì§šì–´ë³´ê¸° ğŸ“Œ</h3>';
      summaryHTML += `<p><strong>êµ¬ë§¤ ëŒ€ìƒ:</strong> ${item}</p><ul>`;
      originalUserPathWithEmoji.slice(0, -1).filter(p => !p.includes("ë„ìš°ë¯¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤")).forEach(step => {
        summaryHTML += `<li>${step}</li>`;
      });
      summaryHTML += '</ul>';
      container.innerHTML = summaryHTML;

      const buttonsGroup = document.createElement('div');
      buttonsGroup.classList.add('buttons-group');

      ['txt', 'md', 'json'].forEach(ext => {
        const btn = document.createElement('button');
        btn.textContent = `ğŸ’¾ ${ext.toUpperCase()}ë¡œ ì €ì¥`;
        btn.classList.add(`save-${ext}`);
        btn.onclick = () => {
          let content = '';
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          const day = String(today.getDate()).padStart(2, '0');
          const dateString = `${year}${month}${day}`;
          const safeItemName = removeEmoji(item).replace(/\s+/g, '_').replace(/[\\/:*?"<>|]/g, '');
          const fileNameBase = `purchase_decision_${safeItemName || 'item'}_${dateString}`;
          const finalDecisionTitle = removeEmoji(resultTitleEl.textContent);
          const finalDecisionText = removeEmoji(resultTextEl.textContent.split('\n\nğŸ›ï¸')[0]);
          const pathToSave = userPath.filter(p => !p.includes("ë„ìš°ë¯¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤")).join('\n');

          if (ext === 'txt') {
            content = `êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ê²°ê³¼ (${dateString})\n\nêµ¬ë§¤ ëŒ€ìƒ: ${item}\n\n## ê²°ì • ê²½ë¡œ:\n${pathToSave}\n\n---\nìµœì¢… ê²°ì • ìš”ì•½: ${finalDecisionTitle}\n${finalDecisionText}`;
          } else if (ext === 'md') {
            content = `# êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ê²°ê³¼ (${dateString})\n\n**êµ¬ë§¤ ëŒ€ìƒ:** ${item}\n\n## ê²°ì • ê²½ë¡œ\n${userPath.filter(p => !p.includes("ë„ìš°ë¯¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤")).map(s => `- ${s}`).join('\n')}\n\n---\n**ìµœì¢… ê²°ì • ìš”ì•½:** ${finalDecisionTitle}\n\n${finalDecisionText}`;
          } else {
            content = JSON.stringify({
              itemName: item, decisionDate: `${year}-${month}-${day}`,
              decisionPath: userPath.filter(p => !p.includes("ë„ìš°ë¯¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤")),
              finalDecisionTitle: finalDecisionTitle, finalDecisionText: finalDecisionText
            }, null, 2);
          }
          const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = `${fileNameBase}.${ext}`; document.body.appendChild(a);
          a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        };
        buttonsGroup.appendChild(btn);
      });

      const pdfBtn = document.createElement('button');
      pdfBtn.textContent = 'ğŸ“„ PDFë¡œ ì €ì¥';
      pdfBtn.classList.add('save-pdf');
      pdfBtn.onclick = () => {
        if (typeof html2pdf !== 'undefined') {
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          const day = String(today.getDate()).padStart(2, '0');
          const dateString = `${year}${month}${day}`;
          const safeItemName = removeEmoji(item).replace(/\s+/g, '_').replace(/[\\/:*?"<>|]/g, '');
          const fileNameBase = `purchase_decision_${safeItemName || 'item'}_${dateString}`;
          let pdfContentHTML = `<h1>ğŸ’• êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ê²°ê³¼ ğŸ’•</h1>`;
          pdfContentHTML += `<h2>âœ¨ "${item}"ì— ëŒ€í•œ ê²°ì • (${year}-${month}-${day}) âœ¨</h2>`;
          pdfContentHTML += `<h3>ìµœì¢… ê²°ê³¼: ${resultTitleEl.textContent}</h3>`;
          pdfContentHTML += `<p>${resultTextEl.textContent.replace(/\n/g, '<br>')}</p>`;
          pdfContentHTML += `<h3>ğŸ“Œ ë‚˜ì˜ ê²°ì • ë˜ì§šì–´ë³´ê¸° ğŸ“Œ</h3><ul>`;
          originalUserPathWithEmoji.filter(p => !p.includes("ë„ìš°ë¯¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤") && !p.startsWith("â¡ï¸ ìµœì¢… ê²°ê³¼:")).forEach(step => {
            pdfContentHTML += `<li>${step}</li>`;
          });
          pdfContentHTML += `</ul>`;
          const elementToPrint = document.createElement('div');
          elementToPrint.style.fontFamily = "'Nanum Gothic', 'Jua', sans-serif"; elementToPrint.style.padding = "20px";
          elementToPrint.innerHTML = pdfContentHTML;
          const opt = { margin: 1, filename: `${fileNameBase}.pdf`, image: { type: 'jpeg', quality: 0.98 }, html2canvas:  { scale: 2, logging: true, useCORS: true, letterRendering: true }, jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }};
          html2pdf().from(elementToPrint).set(opt).save();
        } else {
          alert('PDF ì €ì¥ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜, ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”. (html2pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘)');
        }
      };
      buttonsGroup.appendChild(pdfBtn);

      const copyBtn = document.createElement('button');
      copyBtn.textContent = 'ğŸ“‹ ê²°ê³¼ ë‚´ìš© ë³µì‚¬';
      copyBtn.classList.add('copy-button');
      copyBtn.onclick = () => {
        const today = new Date();
        const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        const itemNameToCopy = itemNameInput.value.trim() || 'ì…ë ¥ëœ ì•„ì´í…œ ì—†ìŒ';
        const resultTitleToCopy = resultTitleEl.textContent;
        const resultTextToCopy = resultTextEl.textContent.split('\n\nğŸ›ï¸')[0];
        let contentToCopy = `ğŸ›ï¸ êµ¬ë§¤ ëŒ€ìƒ: ${itemNameToCopy}\nğŸ—“ï¸ ê²°ì •ì¼: ${dateString}\n\nâœ¨ ìµœì¢… ê²°ì •: ${resultTitleToCopy}\n${resultTextToCopy}\n\nğŸ“Œ ê²°ì • ê²½ë¡œ ìš”ì•½:\n`;
        originalUserPathWithEmoji.filter(p => !p.includes("ë„ìš°ë¯¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤") && !p.startsWith("â¡ï¸ ìµœì¢… ê²°ê³¼:")).forEach(step => {
          contentToCopy += `- ${step}\n`;
        });
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(contentToCopy)
            .then(() => { alert('ê²°ê³¼ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); })
            .catch(err => { console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err); alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); });
        } else {
          const textArea = document.createElement("textarea");
          textArea.value = contentToCopy;
          textArea.style.position = "fixed"; textArea.style.left = "-9999px";
          document.body.appendChild(textArea);
          textArea.focus(); textArea.select();
          try { document.execCommand('copy'); alert('ê²°ê³¼ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); }
          catch (err) { console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ (execCommand):', err); alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); }
          document.body.removeChild(textArea);
        }
      };
      buttonsGroup.appendChild(copyBtn);
      
      container.appendChild(buttonsGroup);
      restartButton.insertAdjacentElement('beforebegin', container);
    }

    function restart() {
      currentQuestionId = 'start';
      userPath = [];
      originalUserPathWithEmoji = [];
      pathListEl.innerHTML = '';
      itemNameInput.value = '';

      const summaryContainer = resultArea.querySelector('.summary-and-buttons-container');
      if (summaryContainer) {
        resultArea.removeChild(summaryContainer);
      }
      logToPath('âœ¨ êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ë„ìš°ë¯¸ë¥¼ ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤ âœ¨', 'âœ¨ êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ë„ìš°ë¯¸ë¥¼ ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤ âœ¨');
      displayQuestion(currentQuestionId);
      window.scrollTo(0, 0);
    }

    logToPath('âœ¨ êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ë„ìš°ë¯¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤ âœ¨', 'âœ¨ êµ¬ë§¤ ì˜ì‚¬ ê²°ì • ë„ìš°ë¯¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤ âœ¨');
    displayQuestion(currentQuestionId);

    const pdfScript = document.createElement('script');
    pdfScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
    pdfScript.integrity = 'sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==';
    pdfScript.crossOrigin = 'anonymous';
    pdfScript.onload = () => console.log('ğŸ“„ html2pdf.js ë¡œë“œ ì™„ë£Œ');
    pdfScript.onerror = () => { console.error('html2pdf.js ë¡œë“œ ì‹¤íŒ¨.'); };
    document.body.appendChild(pdfScript);
  </script>
</body>
</html>